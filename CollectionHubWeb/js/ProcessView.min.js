function refreshHistoricProcessInfo(){$.ajax({type:"POST",url:"DataService.aspx/GetBatchProcessFieldsFromRun",data:"{'batchRunId': "+QueryString().b+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){a.hasOwnProperty("d")&&(a=a.d),jQuery.each(a,function(){addFieldToForm(this)}),applyDatePickers()}})}function refreshProcessInfo(){$.ajax({type:"POST",url:"DataService.aspx/GetBatchProcessFields",data:"{'bp_id': "+QueryString().p+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){a.hasOwnProperty("d")&&(a=a.d),jQuery.each(a,function(){addFieldToForm(this)}),applyDatePickers()}})}function refreshProcessHeader(){$.ajax({type:"POST",url:"DataService.aspx/GetBatchProcess",data:"{'bp_id': "+QueryString().p+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){a.hasOwnProperty("d")&&(a=a.d),jQuery.each(a,function(){$("#processTitle").append("<h3>"+this.BatchName+"</h3>"),$("#processDescription").append("<h4>"+this.Description+"</h4>")})}})}function addFieldToForm(a){var b="";"string"==a.DataType&&(b=getTextBox(a)),"currency"==a.DataType&&(b=getTextBox(a)),"textarea"==a.DataType&&(b=getTextArea(a)),"datetime"==a.DataType&&(b=getDateTime(a)),"boolean"==a.DataType&&(b=getCheckBox(a)),"multiselect"==a.DataType&&(b=getMultiSelect(a)),"select"==a.DataType&&(b=getMultiSelect(a)),$("#processFieldTags").append(b)}function getTextBox(a){return'<div class="form-group"><label>'+a.FieldLabel+"</label><input "+isRequired(a)+' id="auto_'+a.bf_id+'" class="form-control" value="'+a.DefaultValue+'"><p class="help-block">'+a.HelpText+"</p></div>"}function getTextArea(a){return'<div class="form-group"><label>'+a.FieldLabel+"</label><textarea "+isRequired(a)+' id="auto_'+a.bf_id+'" class="form-control" >'+a.DefaultValue+'</textarea><p class="help-block">'+a.HelpText+"</p></div>"}function getDateTime(a){return'<div class="form-group"><label>'+a.FieldLabel+"</label><input "+isRequired(a)+' name="datepickerEnabled" id="auto_datepicker_'+a.bf_id+'" class="form-control" value="'+a.DefaultValue+'"><p class="help-block">'+a.HelpText+"</p></div>"}function getCheckBox(a){return'<div class="form-group"><label>'+a.FieldLabel+'</label><div class="checkbox"><label><input '+isRequired(a)+' id="auto_'+a.bf_id+'" type="checkbox" value="'+a.DefaultValue+'">'+a.HelpText+"</label></div></div>"}function getMultiSelect(a){var b="",c="",d=a.FieldData.split(";");for(i=0;i<d.length;i++){var e="",f=d[i].split("|");f[1]==a.DefaultValue&&(e='selected="selected"'),c+='<option value="'+f[1]+'" '+e+">"+f[0]+"</option>"}var g="";return"multiselect"==a.DataType&&(g="multiple"),b='<div class="form-group"><label>'+a.FieldLabel+"</label><select "+isRequired(a)+' id="auto_'+a.bf_id+'" '+g+' class="form-control">'+c+"</select></div>\n"}function isRequired(a){var b="";return a.IsMandatory&&(b="required"),b}function applyDatePickers(){$("input[name='datepickerEnabled']").datepicker()}function postValues(){if($("#mainForm").valid()){var a="";$("input[id^='auto_']").each(function(){var b=$(this).attr("id"),c=$(this).val();a+=b+"="+c+"&"}),$("select[id^='auto_']").each(function(){var b=$(this).attr("id"),c=$(this).val();a+=b+"="+c+"&"}),a=Base64.encode(a),$("#searchPane").hide(100),$("#resultsPane").show(100),$.ajax({type:"POST",url:"DataService.aspx/SaveBatchParameters",data:"{'batchId':'"+QueryString().p+"','userId':'"+$("#UserSessionToken").val()+"','base64String':'"+a+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){a.hasOwnProperty("d")&&(a=a.d),$("#BatchRunId").val(a),refreshBatchRun(a),$("#resultsPane").css("visibility","visible")}})}}function refreshBatchRun(a){$.ajax({type:"POST",url:"DataService.aspx/GetBatchRunRecords",data:"{'batchRunId':'"+a+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){a.hasOwnProperty("d")&&(a=a.d),$("#dataTableBatchResults").dataTable({destroy:!0,aaData:a,aoColumns:[{mData:"RowIdentifier"},{mData:"Source"},{mData:"DebtAccount"},{mData:"FullName"},{mData:"FullAddress"},{mData:"ThisDebt"},{mData:"ThisDebtOS"},{mData:"DebtCount"},{mData:"AllDebtAmount"},{mData:"AllDebtOS"},{mData:"FromDate"},{mData:"UntilDate"}],aoColumnDefs:[{sTitle:"",aTargets:["RowIdentifier"],bVisible:!0,mRender:function(a,b,c){return null!=a?c.Included?'<input type="checkbox" checked name="auto_'+a+'" value="'+a+'" >':'<input type="checkbox" name="auto_'+a+'" value="'+a+'">':""}},{sTitle:"",aTargets:["RecordID"],bVisible:!1},{sTitle:"",aTargets:["Included"],bVisible:!1},{sTitle:"",aTargets:["PIN"],bVisible:!1},{sTitle:"",aTargets:["UPRN"],bVisible:!1},{sTitle:"From Date",aTargets:["FromDate"],mRender:function(a){if(null!=a){var b=new Date(parseInt(a.substr(6))),c=moment(b);return c.format("DD/MM/YYYY")}return""}},{sTitle:"Until Date",aTargets:["UntilDate"],mRender:function(a){if(null!=a){var b=new Date(parseInt(a.substr(6))),c=moment(b);return c.format("DD/MM/YYYY")}return""}}],initComplete:function(){$('input[type="checkbox"]').change(function(){savePreference(this.checked,this.name)})}})}})}function activateBatch(){0!=$("#newBatchName").val().length&&($.ajax({type:"POST",url:"DataService.aspx/ActivateBatch",data:"{'batchId':'"+$("#BatchRunId").val()+"','batchName':'"+$("#newBatchName").val()+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(){$("#searchPane").show(500),$("#resultsPane").hide(500)}}),$("#acceptApprove").modal("hide"),window.location.replace("Processes.aspx"))}function cancelBatch(){$.ajax({type:"POST",url:"DataService.aspx/DeactivateBatch",data:"{'batchId':'"+$("#BatchRunId").val()+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(){$("#searchPane").show(500),$("#resultsPane").hide(500)}}),$("#cancelApprove").modal("hide"),window.location.replace("Processes.aspx")}function savePreference(a,b){var c=b.split("_")[1];$.ajax({type:"POST",url:"DataService.aspx/SaveBatchIncludeStatus",data:"{'recordIdentifier':'"+c+"','include':'"+a+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(){}})}function loadBatchName(){$.ajax({type:"POST",url:"DataService.aspx/GetBatchName",data:"{'batchId':'"+$("#BatchRunId").val()+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){$("#newBatchName").val(a.d)},error:function(){alert("Could not get batch name")}})}function isHistoric(){var a=QueryString().b;return"undefined"==typeof a?!1:!0}$("#resultsPane").hide(),refreshProcessHeader(),isHistoric()?refreshHistoricProcessInfo():refreshProcessInfo();