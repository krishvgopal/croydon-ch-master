<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Create Arrangement</title></head><body><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">Create Arrangement</h4></div><div class="modal-body" style="height:580px"><div id="arrangementScreen" style="display:block;height:100%"><p>Fill in the below to create a new arrangement</p><br><div style="width:45%;margin-left:10px;float:left;height:auto"><div class="form-group"><label>Agreement Date</label><input type="text" id="agmAgreementDate" class="date-picker form-control"></div><div class="form-group"><label>Frequency</label><select id="agmFrequency" class="form-control" onchange="refreshForm()"></select></div><div class="form-group"><label>Starting Date</label><input type="text" id="agmStartDate" class="date-picker form-control"></div><div class="form-group" id="fgAgreedAmount"><label>Agreed Amount</label><div class="form-group input-group"><span class="input-group-addon"><i class="fa fa-gbp"></i></span> <input type="text" id="agmAgreedAmount" class="form-control" onchange="updateAgreedAmount()"></div></div><div class="fcyNoShow"><div class="form-group"><label>No. of installments</label><input type="text" id="agmNumberOfInstallments" class="form-control" onchange="updateCalculation(3)"></div></div></div><div style="width:45%;margin-right:10px;float:right;height:auto"><div class="form-group"><label>Total Debt Amount</label><div class="form-group input-group"><span class="input-group-addon"><i class="fa fa-gbp"></i></span> <input type="text" class="form-control" id="agmTotalDebtAmount" class="form-control" disabled="disabled"></div></div><div id="fcyWeekly" style="display: inline-block"><div class="form-group"><label>Day of week</label><select id="agmDayOfWeek" class="form-control"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option></select></div></div><div id="fcyMonthly" style="display: none"><div class="form-group"><label>Day of month</label><select id="agmDayOfMonth" class="form-control"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option></select></div></div><div id="fcyOneOff" style="display: none"><div class="form-group"><label>Payment Date</label><input type="text" id="agmPaymentDate" class="date-picker form-control"></div></div><div class="form-group"><label>Payment Method</label><select id="agmPaymentMethod" class="form-control"></select></div><div class="form-group"><label>Initial Downpayment Amount</label><div class="form-group input-group"><span class="input-group-addon"><i class="fa fa-gbp"></i></span> <input type="text" id="agmStartAmount" class="form-control" onchange="updateCalculation(1)"></div></div><div class="fcyNoShow"><div class="form-group"><label>Installment Amount</label><div class="form-group input-group"><span class="input-group-addon"><i class="fa fa-gbp"></i></span> <input type="text" id="agmInstallmentAmount" class="form-control" onchange="updateCalculation(2)"></div></div><div class="form-group" style="visibility: visible"><label>Last Payment Amount</label><div class="form-group input-group"><span class="input-group-addon"><i class="fa fa-gbp"></i></span> <input type="text" id="agmLastAmount" class="form-control"></div></div></div></div><div class="modal-footer" style="width:100%;clear:both;margin-top:300px"><button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> <button type="button" class="btn btn-default" onclick="showSchedule()">Show Breakdown</button> <button type="button" class="btn btn-primary disabled" onclick="createArrangementWrapper()" id="formCreate">Create Arrangement</button></div></div><div id="scheduleScreen" style="display:none;height:100%"><p>Please review the schedule below.</p><br><div style="overflow:scroll; height:380px"><table class="table table-striped table-bordered table-hover" id="paymentSchedule"><thead><tr><th>Payment Date</th><th>Payment Amount</th></tr></thead><tbody></tbody></table></div><div class="modal-footer" style="width:100%;clear:both;margin-top:45px"><button type="button" class="btn btn-default" onclick="showArrangement()">Back</button> <button type="button" class="btn btn-primary disabled" onclick="createArrangementWrapper()" id="formCreate">Create Arrangement</button></div></div></div><script>function updateCalculation(e){var a=$("#agmNumberOfInstallments").val(),t=$("#agmInstallmentAmount").val(),m=$("#agmAgreedAmount").val(),n=$("#agmLastAmount").val(),r=$("#agmStartAmount").val();if("undefined"==r&&$("#agmStartAmount").val("0"),"undefined"==n&&$("#agmLastAmount").val("0"),"undefined"==a&&$("#agmNumberOfInstallments").val("1"),"undefined"==t&&$("#agmInstallmentAmount").val("0"),"undefined"==m&&$("#agmAgreedAmountagmLastAmount").val("0"),2==e){var o=m-r,l=o/t,d=l.toFixed(0),g=d*t,u=m-g;$("#agmNumberOfInstallments").val(d),$("#agmLastAmount").val(u)}if(3==e||1==e){var s=(m-r)/a,v=+s.toFixed(2),y=v*a,i=m-r-y,f=+i.toFixed(2),c=f+v;$("#agmInstallmentAmount").val(v.toFixed(2)),$("#agmLastAmount").val(c.toFixed(2))}}function updateAgreedAmount(){var e=$("#agmAgreedAmount").val(),a=$("#agmTotalDebtAmount").val();e>a?($("#fgAgreedAmount").addClass("has-error"),$("#formCreate").prop("disabled",!0)):($("#fgAgreedAmount").removeClass("has-error"),$("#formCreate").prop("disabled",!1))}function formatDate(){var e=new Date,a=e.getDate(),t=e.getMonth()+1,m=e.getFullYear();return 10>a&&(a="0"+a),10>t&&(t="0"+t),a+"/"+t+"/"+m}function refreshForm(){var e=$("#agmFrequency").val();1==e&&($("#fcyWeekly").show(),$("#fcyMonthly").hide(),$("#fcyOneOff").hide(),$(".fcyNoShow").show()),2==e&&($("#fcyWeekly").hide(),$("#fcyMonthly").show(),$("#fcyOneOff").hide(),$(".fcyNoShow").show()),3==e&&($("#fcyWeekly").hide(),$("#fcyMonthly").hide(),$("#fcyOneOff").show(),$(".fcyNoShow").hide())}function insertRow(e,a,t){var m=document.getElementById("paymentSchedule"),n=m.insertRow(1),r=n.insertCell(0),o=n.insertCell(1);""!=t?(r.innerHTML="<i>"+e+"</i>",o.innerHTML=a):(r.innerHTML=e,o.innerHTML=a)}function clearRows(){$("#paymentSchedule tr").remove();var e=document.getElementById("paymentSchedule"),a=e.insertRow(0),t=a.insertCell(0),m=a.insertCell(1);t.innerHTML="<strong>Payment Date</strong>",m.innerHTML="<strong>Payment Amount</strong>"}function showSchedule(){$("#paymentSchedule:not(:first)").remove();{var e=$("#agmFrequency").val(),a=$("#agmNumberOfInstallments").val(),t=$("#agmInstallmentAmount").val(),m=$("#agmPaymentDate").val(),n=($("#agmStartDate").val(),$("#agmStartAmount").val(),$("#agmLastAmount").val());$("#agmDayOfMonth").val(),$("#agmDayOfWeek").val(),formatDate()}if(clearRows(),1==e){console.log("WEEKLY");for(var r=0;a>r;r++){var o=moment(m,"dd/mm/yy").add(r,"weeks").format("DD/MM/YYYY");r==a-1?insertRow(o,n,""):insertRow(o,t,"i")}}if(2==e){console.log("MONTHLY");for(var r=0;a>r;r++){var o=moment(m,"dd/mm/yy").add(r,"months").format("DD/MM/YYYY");r==a-1?insertRow(o,n,""):insertRow(o,t,"i")}}3==e&&console.log("ONEOFF"),$("#arrangementScreen").hide(),$("#scheduleScreen").show()}function showArrangement(){$("#scheduleScreen").hide(),$("#arrangementScreen").show()}function createArrangementWrapper(){var e=$("#agmStartDate").val(),a=$("#agmFrequency").val(),t=$("#agmDayOfMonth").val(),m=$("#agmDayOfWeek").val(),n=$("#agmStartAmount").val(),r=$("#agmInstallmentAmount").val(),o=$("#agmNumberOfInstallments").val(),l=$("#agmPaymentMethod").val(),d=$("#agmAgreedAmount").val(),g=$("#agmTotalDebtAmount").val(),u=$("#agmLastAmount").val(),s=$("#agmAgreementDate").val(),v=$("#agmPaymentDate").val();s=moment(s,"dd/mm/yyyy").format("YYYY-MM-DD"),v=moment(v,"dd/mm/yyyy").format("YYYY-MM-DD"),e=moment(e,"dd/mm/yyyy").format("YYYY-MM-DD"),createAgreement(e,a,t,m,n,r,o,l,d,g,u,s,v,e)}var currentDate=formatDate();refreshForm(),$("#agmTotalDebtAmount").val($("#debtRowTotalValue").val()),$("#agmAgreedAmount").val($("#debtRowTotalValue").val()),$("#agmNumberOfInstallments").val("1"),$("#agmInstallmentAmount").val("0"),$("#agmStartAmount").val("0"),$("#agmLastAmount").val("0"),$("#agmPaymentStartDate").datepicker({dateFormat:"dd/mm/yy"}),$("#agmAgreementDate").datepicker({dateFormat:"dd/mm/yy"}),$("#agmPaymentDate").datepicker({dateFormat:"dd/mm/yy"}),$("#agmStartDate").datepicker({dateFormat:"dd/mm/yy"}),$("#agmPaymentStartDate").val(currentDate),$("#agmAgreementDate").val(currentDate),$("#agmPaymentDate").val(currentDate),$("#agmStartDate").val(currentDate),loadArrangementFrequenciesList(),loadArrangementPaymentMethodList();</script></body></html>